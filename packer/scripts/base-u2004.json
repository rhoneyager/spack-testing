{
	"variables": {
		"destination_regions": "us-east-1"
	},
	"builders": [
		{
			"type": "lxd",
			"image": "ubuntu:focal",
			"output_image": "base/u2004",
			"publish_properties": {
				"description": "Base image"
			}
		},
		{
			"type": "amazon-ebs",
			"ami_name": "ryan-base-u2004 {{timestamp}}",
			"ami_description": "Base image for spack",
			"region": "us-east-1",
			"instance_type": "t2.small",
			"source_ami_filter": {
				"filters": {
					"name": "*ubuntu-focal-20.04-amd64-server-*",
					"root-device-type": "ebs",
					"virtualization-type": "hvm"
				},
				"most_recent": true,
				"owners": ["099720109477"]
			},
			"ami_regions": "{{user `destination_regions`}}",
			"ssh_username": "ubuntu"
		}
	],
	"provisioners": [
		{
			"type": "shell",
			"inline": [
				"export DEBIAN_FRONTEND=noninteractive",
				"sudo -E apt-get update",
				"sudo -E apt-get upgrade -y",
				"sudo -E apt-get install -y --no-install-recommends autoconf automake bash bison bzip2 diffutils findutils flex git krb5-user libkrb5-dev libtool m4 libncurses-dev libssl-dev ninja-build openjdk-11-jdk perl pkg-config python3 ruby tar texinfo xz-utils",
				"sudo -E apt-get install -y --no-install-recommends bc build-essential clang-format clang-tidy csh curl file gdb ksh less lldb lsb-release man-db nano openssh-server screen tcl tcsh time tk unzip vim-nox wget wish",
				"sudo -E apt-get install -y --no-install-recommends gcc-10 g++-10 gfortran-10",
				"sudo -E apt-get install -y --no-install-recommends gcc-9 g++-9 gfortran-9",
				"sudo -E apt-get install -y --no-install-recommends gcc-8 g++-8 gfortran-8",
				"sudo -E apt-get install -y --no-install-recommends clang-11 clang-10 clang-9",
				"sudo update-alternatives --install /usr/bin/g++ g++ $(which g++-10) 30",
				"sudo update-alternatives --install /usr/bin/gcc gcc $(which gcc-10) 30",
				"sudo update-alternatives --install /usr/bin/gcov gcov $(which gcov-10) 30",
				"sudo update-alternatives --install /usr/bin/gfortran gfortran $(which gfortran-10) 30",
				"sudo update-alternatives --install /usr/bin/clang clang $(which clang-11) 30",
				"sudo update-alternatives --install /usr/bin/clang++ clang++ $(which clang-11) 30"
			]
		}
	]
}


